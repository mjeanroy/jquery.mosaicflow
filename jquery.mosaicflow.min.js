/*! jQuery Mosaic Flow v0.2.5 by Artem Sapegin - http://sapegin.github.io/jquery.mosaicflow/ - Licensed MIT */
!function(a,b){if("function"==typeof define&&define.amd)define("MosaicFlow",["jquery"],b);else if("undefined"!=typeof exports)b(require("jquery"));else{var c={exports:{}};b(a.jQuery),a.MosaicFlow=c.exports}}(this,function(a){"use strict";function b(a){return a&&a.__esModule?a:{"default":a}}function c(a,b){this.container=a,this.options=b,this.container.trigger("mosaicflow-start"),this.init(),this.container.trigger("mosaicflow-ready")}function d(a){function b(a,b){return b.toUpper()}var c={},d=a.data();for(var e in d)c[e.replace(/-(\w)/g,b)]=d[e];return c}function e(a){var b={};if(b.height=parseInt(a.attr("height"),10),b.width=parseInt(a.attr("width"),10),0===b.height||0===b.width){var c=new Image;c.src=a.attr("src"),b.width=c.width,b.height=c.height}return b}var f=b(a);f["default"].fn.mosaicflow=function(a){var b=Array.prototype.slice.call(arguments,0);return this.each(function(){var e=f["default"](this),g=e.data("mosaicflow");g?"string"==typeof a&&g[a](b[1]):(a=f["default"].extend({},f["default"].fn.mosaicflow.defaults,a,d(e)),g=new c(e,a),e.data("mosaicflow",g))})},f["default"].fn.mosaicflow.defaults={itemSelector:"> *",columnClass:"mosaicflow__column",minItemWidth:240,minColumns:2,itemHeightCalculation:"auto",threshold:40};var g=0;c.prototype={init:function(){this.__uid=g++,this.__uidItemCounter=0,this.items=this.container.find(this.options.itemSelector),this.columns=f["default"]([]),this.columnsHeights=[],this.itemsHeights={},this.tempContainer=f["default"]("<div>").css({visibility:"hidden",width:"100%"}),this.workOnTemp=!1,this.autoCalculation="auto"===this.options.itemHeightCalculation,this.container.append(this.tempContainer);var a=this;this.items.each(function(){var b=f["default"](this),c=b.attr("id");c||(c=a.generateUniqueId(),b.attr("id",c))}),this.container.css("visibility","hidden"),this.autoCalculation?f["default"](window).on("load",f["default"].proxy(this.refill,this)):this.refill(),f["default"](window).resize(f["default"].proxy(this.refill,this))},refill:function(){this.container.trigger("mosaicflow-fill"),this.numberOfColumns=Math.floor(this.container.width()/this.options.minItemWidth),this.numberOfColumns<this.options.minColumns&&(this.numberOfColumns=this.options.minColumns);var a=this.ensureColumns();a&&(this.fillColumns(),this.columns.filter(":visible").length>0&&this.columns.filter(":hidden").remove()),this.container.css("visibility","visible"),this.container.trigger("mosaicflow-filled")},ensureColumns:function(){var a=this.columns.filter(":visible").length,b=this.numberOfColumns;if(this.workingContainer=0===a?this.tempContainer:this.container,b>a)for(var c=b-a,d=0;c>d;d++){var e=f["default"]("<div>",{"class":this.options.columnClass});this.workingContainer.append(e)}else if(a>b){for(var g=a;g>=b;)this.columns.eq(g).hide(),g--;var h=a-b;this.columnsHeights.splice(this.columnsHeights.length-h,h)}return b!==a?(this.columns=this.workingContainer.find("."+this.options.columnClass),this.columns.css("width",100/b+"%"),!0):!1},fillColumns:function(){for(var a=this.numberOfColumns,b=this.items.length,c=0;a>c;c++){var d=this.columns.eq(c);this.columnsHeights[c]=0;for(var e=c;b>e;e+=a){var f=this.items.eq(e),g=0;d.append(f),g=this.autoCalculation?f.outerHeight():parseInt(f.find("img").attr("height"),10),this.itemsHeights[f.attr("id")]=g,this.columnsHeights[c]+=g}}this.levelBottomEdge(this.itemsHeights,this.columnsHeights),this.workingContainer===this.tempContainer&&this.container.append(this.tempContainer.children()),this.container.trigger("mosaicflow-layout")},levelBottomEdge:function(a,b){for(;;){var c=f["default"].inArray(Math.min.apply(null,b),b),d=f["default"].inArray(Math.max.apply(null,b),b);if(c===d)return;var e=this.columns.eq(d).children().last(),g=a[e.attr("id")],h=b[c],i=b[d],j=h+g;if(j>=i)return;if(i-j<this.options.threshold)return;this.columns.eq(c).append(e),b[d]-=g,b[c]+=g}},add:function(a){this.container.trigger("mosaicflow-item-add",[a]);var b=f["default"].inArray(Math.min.apply(null,this.columnsHeights),this.columnsHeights),c=0;if(this.autoCalculation){a.css({position:"static",visibility:"hidden",display:"block"}).appendTo(this.columns.eq(b)),c=a.outerHeight();var d=a.find("img");0!==d.length&&d.each(function(){var a=f["default"](this),b=e(a),d=a.width()*b.height/b.width;c+=d}),a.detach().css({position:"static",visibility:"visible"})}else c=parseInt(a.find("img").attr("height"),10);a.attr("id")||a.attr("id",this.generateUniqueId());var g=this.items.toArray();g.push(a),this.items=f["default"](g),this.itemsHeights[a.attr("id")]=c,this.columnsHeights[b]+=c,this.columns.eq(b).append(a),this.levelBottomEdge(this.itemsHeights,this.columnsHeights),this.container.trigger("mosaicflow-layout"),this.container.trigger("mosaicflow-item-added",[a])},remove:function(a){this.container.trigger("mosaicflow-item-remove",[a]);var b=a.parents("."+this.options.columnClass);this.columnsHeights[b.index()-1]-=this.itemsHeights[a.attr("id")],a.detach(),this.items=this.items.not(a),this.levelBottomEdge(this.itemsHeights,this.columnsHeights),this.container.trigger("mosaicflow-layout"),this.container.trigger("mosaicflow-item-removed",[a])},empty:function(){var a=this.numberOfColumns;this.items=f["default"]([]),this.itemsHeights={};for(var b=0;a>b;b++){var c=this.columns.eq(b);this.columnsHeights[b]=0,c.empty()}this.container.trigger("mosaicflow-layout")},recomputeHeights:function(){function a(a,c){c=f["default"](c);var e=0;e=b.autoCalculation?c.outerHeight():parseInt(c.find("img").attr("height"),10),b.itemsHeights[c.attr("id")]=e,b.columnsHeights[d]+=e}for(var b=this,c=this.numberOfColumns,d=0;c>d;d++){var e=this.columns.eq(d);this.columnsHeights[d]=0,e.children().each(a)}},generateUniqueId:function(){return this.__uidItemCounter++,"mosaic-"+this.__uid+"-itemid-"+this.__uidItemCounter}},f["default"](function(){f["default"](".mosaicflow").mosaicflow()})});